name: 'run-push-build-artifact'
description:  'Runs the push_build)artifacts.sh for a single artifact'
inputs:
    env-file:
        description: 'Path to the env file'
        default: /var/spacedev/env/spacefx.env
    artifact:
        description: 'Path to the artifact to push'
        required: true
    architecture:
        description: 'The architecture for the image'
        required: true
runs:
    using: 'composite'
    steps:
        - name: Move artifact to SPACEFX_DIR
          shell: bash
          run: |
            source ${{ inputs.env-file }}
            mkdir -p $SPACEFX_DIR/tmp
            mv ${{ inputs.artifact }} $SPACEFX_DIR/tmp


        - name: Push Artifact ${{ inputs.artifact }}
          shell: bash
          run: |
            source ${{ inputs.env-file }}

            artifact_path=$SPACEFX_DIR/tmp/$(basename ${{ inputs.artifact }})

            echo "Running  bash ${SPACEFX_DIR}/build/push_build_artifact.sh --artifact ${artifact_path} --architecture ${{ inputs.architecture }} --artifact-version ${SPACEFX_VERSION}"
            
            bash ${SPACEFX_DIR}/build/push_build_artifact.sh --artifact ${artifact_path} --architecture ${{ inputs.architecture }} --artifact-version ${SPACEFX_VERSION}